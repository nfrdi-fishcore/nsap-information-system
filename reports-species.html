<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Report - NSAP Information System</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="https://nsap.nfrdi.da.gov.ph/dist/img/logo/nsap_orig.svg">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.js"></script>
    <!-- Sidebar Styles -->
    <link rel="stylesheet" href="src/assets/css/components/sidebar.css">
    <!-- Notification Styles -->
    <link rel="stylesheet" href="src/assets/css/components/notifications.css">
    <!-- Loading Styles -->
    <link rel="stylesheet" href="src/assets/css/components/loading.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fa;
            margin: 0;
        }

        .main-content {
            padding: 2rem;
            position: relative;
            min-height: calc(100vh - 80px);
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title h1 {
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }

        .page-title p {
            color: #718096;
            margin-bottom: 0;
        }

        .content-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }

        .filters-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .filters-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: #cbd5e1;
        }

        .filters-card h5 {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
        }

        .filters-card h5 i {
            color: #3b82f6;
            font-size: 1.25rem;
        }

        .filters-card .form-label {
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .filters-card .row {
            align-items: end;
        }

        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.06);
            border-color: #cbd5e1;
        }

        .summary-card h6 {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .summary-card .unit {
            font-size: 0.875rem;
            color: #718096;
        }

        .chart-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.06);
            border-color: #cbd5e1;
        }

        .chart-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-card-header h5 {
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 1rem;
        }

        .table-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }

        .table-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-card-header h5 {
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }

        .table thead th {
            background-color: #f8fafc;
            color: #4a5568;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            padding: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .table tbody td {
            vertical-align: middle;
            padding: 1rem;
            color: #2d3748;
            border-bottom: 1px solid #edf2f7;
        }

        .btn-export {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-export:hover {
            background-color: #047857;
            border-color: #047857;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .custom-dropdown {
            position: relative;
        }

        .custom-dropdown-toggle {
            width: 100%;
            text-align: left;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .custom-dropdown-toggle:hover {
            border-color: #86b7fe;
        }

        .custom-dropdown-toggle:focus {
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .custom-dropdown-toggle .bi-chevron-down {
            transition: transform 0.2s ease;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .custom-dropdown-toggle[aria-expanded="true"] .bi-chevron-down {
            transform: rotate(180deg);
        }

        .custom-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            display: none;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            margin-top: 0.25rem;
        }

        .custom-dropdown-menu.show {
            display: block;
        }

        .custom-dropdown-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.15s ease-in-out;
        }

        .custom-dropdown-item:hover {
            background-color: #f8f9fa;
        }

        .custom-dropdown-item input[type="checkbox"] {
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .custom-dropdown-item label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .custom-dropdown-actions {
            padding: 0.5rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 0.5rem;
        }

        .custom-dropdown-actions button {
            flex: 1;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }

        .instruction-modal .modal-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-bottom: none;
        }

        .instruction-modal .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .instruction-modal .modal-body {
            padding: 2rem;
        }

        .instruction-modal .instruction-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .instruction-modal .instruction-step:last-child {
            margin-bottom: 0;
        }

        .instruction-modal .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 0.875rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .instruction-modal .step-content h6 {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .instruction-modal .step-content p {
            color: #4a5568;
            margin: 0;
            font-size: 0.9375rem;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .chart-container {
                height: 300px;
            }

            .instruction-modal .modal-body {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar Component -->
    <div id="sidebarContainer"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="page-header">
            <div class="page-title">
                <h1>Species Report</h1>
                <p>Detailed analysis of species catch data</p>
            </div>
        </div>

        <!-- Filters Card -->
        <div class="filters-card">
            <h5><i class="bi bi-funnel"></i>Report Parameters</h5>
            <!-- Date Range Row -->
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label text-secondary small text-uppercase fw-bold">From Date</label>
                    <input type="date" class="form-control" id="fromDate" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-secondary small text-uppercase fw-bold">To Date</label>
                    <input type="date" class="form-control" id="toDate" required>
                </div>
            </div>
            <!-- Other Filters Row -->
            <div class="row g-3 mb-3">
                <div class="col-md-4" id="regionFilterGroup">
                    <label class="form-label text-secondary small text-uppercase fw-bold">Region</label>
                    <select class="form-select" id="filterRegion">
                        <option value="">All Regions</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label text-secondary small text-uppercase fw-bold">Gear Type</label>
                    <select class="form-select" id="filterGear">
                        <option value="">All Gear Types</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label text-secondary small text-uppercase fw-bold">Species</label>
                    <div class="custom-dropdown">
                        <button type="button" class="custom-dropdown-toggle form-control" id="speciesDropdownToggle" aria-expanded="false">
                            <span id="speciesDropdownText" class="text-muted">Select species...</span>
                            <i class="bi bi-chevron-down"></i>
                        </button>
                        <div class="custom-dropdown-menu" id="speciesDropdownMenu">
                            <div id="speciesCheckboxList">
                                <!-- Populated by JS -->
                            </div>
                            <div class="custom-dropdown-actions">
                                <button type="button" class="btn btn-sm btn-outline-primary" id="selectAllSpeciesBtn">Select All</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllSpeciesBtn">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Generate Button Row -->
            <div class="row">
                <div class="col-12">
                    <button class="btn btn-primary w-100" id="generateReportBtn">
                        <i class="bi bi-file-earmark-text me-2"></i>Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay d-none">
            <div class="loading-spinner"></div>
            <div class="loading-text">Generating report...</div>
        </div>

        <!-- Report Content (initially hidden) -->
        <div id="reportContent" class="d-none">
            <!-- Summary Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="summary-card">
                        <h6>Total Catch</h6>
                        <div class="value" id="summaryTotalCatch">0</div>
                        <div class="unit">kilograms</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-card">
                        <h6>Species Count</h6>
                        <div class="value" id="summarySpecies">0</div>
                        <div class="unit">species</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-card">
                        <h6>Vessels</h6>
                        <div class="value" id="summaryVessels">0</div>
                        <div class="unit">vessels</div>
                    </div>
                </div>
            </div>

            <!-- Export Buttons -->
            <div class="content-card mb-4">
                <div class="d-flex justify-content-end gap-2">
                    <button class="btn btn-export" id="exportCSVBtn">
                        <i class="bi bi-filetype-csv me-2"></i>Export to CSV
                    </button>
                    <button class="btn btn-export" id="exportExcelBtn">
                        <i class="bi bi-file-earmark-spreadsheet me-2"></i>Export to Excel
                    </button>
                    <button class="btn btn-export" id="exportPDFBtn">
                        <i class="bi bi-file-earmark-pdf me-2"></i>Export to PDF
                    </button>
                </div>
            </div>

            <!-- Species Catch Volume Chart -->
            <div class="chart-card">
                <div class="chart-card-header">
                    <h5>Species Catch Volume</h5>
                </div>
                <div class="chart-container">
                    <canvas id="speciesCatchChart"></canvas>
                </div>
            </div>

            <!-- Species Trends Chart -->
            <div class="chart-card">
                <div class="chart-card-header">
                    <h5>Species Trends Over Time</h5>
                </div>
                <div class="chart-container">
                    <canvas id="speciesTrendsChart"></canvas>
                </div>
            </div>

            <!-- Species Data Table -->
            <div class="table-card">
                <div class="table-card-header">
                    <h5>Species Data</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Species Name</th>
                                <th>Family</th>
                                <th>Scientific Name</th>
                                <th class="text-end">Catch (kg)</th>
                                <th class="text-end">Vessels</th>
                            </tr>
                        </thead>
                        <tbody id="speciesDataTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Regional Distribution Table -->
            <div class="table-card">
                <div class="table-card-header">
                    <h5>Regional Distribution by Species</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Region</th>
                                <th>Species</th>
                                <th class="text-end">Catch (kg)</th>
                            </tr>
                        </thead>
                        <tbody id="regionalDistributionTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gear Distribution Table -->
            <div class="table-card">
                <div class="table-card-header">
                    <h5>Gear Type Distribution by Species</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Gear Type</th>
                                <th>Species</th>
                                <th class="text-end">Catch (kg)</th>
                            </tr>
                        </thead>
                        <tbody id="gearDistributionTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Instruction Modal -->
    <div class="modal fade instruction-modal" id="instructionModal" tabindex="-1" aria-labelledby="instructionModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="instructionModalLabel">
                        <i class="bi bi-info-circle me-2"></i>How to Generate Species Report
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h6>Select Date Range</h6>
                            <p>Choose the "From Date" and "To Date" to specify the time period for your species analysis report. These fields are required.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h6>Apply Filters (Optional)</h6>
                            <p>Optionally filter the report by Region, Gear Type, or Species. Use the Species dropdown to select specific species or leave it empty to include all species in the selected date range.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h6>Generate Report</h6>
                            <p>Click the "Generate Report" button to create your species report. The report will include species statistics, catch trends, regional distribution, and gear type analysis.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h6>Export Report (Optional)</h6>
                            <p>After generating the report, you can export it to CSV, Excel, or PDF format using the export buttons at the top of the report.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                        <i class="bi bi-check-circle me-2"></i>Got it!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Configuration (must load before script.js) -->
    <script src="config.js"></script>
    <script src="src/assets/js/core/script.js"></script>
    <script src="src/assets/js/core/notifications.js"></script>
    <script src="src/assets/js/core/components.js"></script>
    <!-- Load utility modules -->
    <script src="src/assets/js/utils/constants.js"></script>
    <script src="src/assets/js/utils/errorHandler.js"></script>
    <script src="src/assets/js/utils/validation.js"></script>
    <!-- Load services -->
    <script src="src/assets/js/services/reportsService.js"></script>
    <script src="src/assets/js/utils/reportExport.js"></script>
    <!-- Load report module -->
    <script src="src/assets/js/modules/reports-species.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Components) {
                window.Components.insert('sidebar', '#sidebarContainer');
                window.Components.initSidebar();
            }
        });
    </script>
</body>

</html>

