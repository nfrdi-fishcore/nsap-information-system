<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout Button Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .debug-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .log {
            background: #fff;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .log div {
            padding: 3px 0;
        }

        .success {
            color: #28a745;
        }

        .error {
            color: #dc3545;
        }

        .info {
            color: #17a2b8;
        }

        .warning {
            color: #ffc107;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1><i class="bi bi-bug"></i> Logout Button Debugger</h1>
        <p>This page helps debug why the logout button isn't working.</p>

        <div class="debug-panel">
            <h3>Step 1: Insert Sidebar</h3>
            <button class="btn btn-primary" onclick="step1()">Insert Sidebar Component</button>
            <div id="step1-result" class="mt-2"></div>
        </div>

        <div class="debug-panel">
            <h3>Step 2: Check Logout Button</h3>
            <button class="btn btn-info" onclick="step2()">Find Logout Button</button>
            <div id="step2-result" class="mt-2"></div>
        </div>

        <div class="debug-panel">
            <h3>Step 3: Manually Attach Event</h3>
            <button class="btn btn-warning" onclick="step3()">Manually Attach Click Event</button>
            <div id="step3-result" class="mt-2"></div>
        </div>

        <div class="debug-panel">
            <h3>Step 4: Test Click</h3>
            <button class="btn btn-success" onclick="step4()">Simulate Click</button>
            <div id="step4-result" class="mt-2"></div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h3>Sidebar Preview:</h3>
                <div id="sidebarContainer"></div>
            </div>
            <div class="col-md-6">
                <h3>Debug Log:</h3>
                <div class="log" id="debugLog"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/components.js"></script>

    <script>
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function step1() {
            log('Step 1: Inserting sidebar component...', 'info');
            const result = document.getElementById('step1-result');

            try {
                if (typeof Components === 'undefined') {
                    throw new Error('Components object not found!');
                }

                Components.insert('sidebar', '#sidebarContainer');
                log('‚úÖ Sidebar inserted successfully', 'success');
                result.innerHTML = '<span class="text-success">‚úÖ Sidebar inserted</span>';
            } catch (error) {
                log('‚ùå Error: ' + error.message, 'error');
                result.innerHTML = '<span class="text-danger">‚ùå ' + error.message + '</span>';
            }
        }

        function step2() {
            log('Step 2: Looking for logout button...', 'info');
            const result = document.getElementById('step2-result');

            const logoutBtn = document.getElementById('logoutBtn');

            if (logoutBtn) {
                log('‚úÖ Logout button found!', 'success');
                log('Button ID: ' + logoutBtn.id, 'info');
                log('Button tag: ' + logoutBtn.tagName, 'info');
                log('Button href: ' + logoutBtn.getAttribute('href'), 'info');
                log('Button text: ' + logoutBtn.textContent.trim(), 'info');

                // Check if it has click listeners
                const hasOnClick = logoutBtn.onclick !== null;
                log('Has onclick: ' + hasOnClick, hasOnClick ? 'success' : 'warning');

                result.innerHTML = '<span class="text-success">‚úÖ Button found: ' + logoutBtn.textContent.trim() + '</span>';
            } else {
                log('‚ùå Logout button NOT found!', 'error');
                log('Available elements with "logout" in ID:', 'info');
                document.querySelectorAll('[id*="logout"]').forEach(el => {
                    log('  - ' + el.id + ' (' + el.tagName + ')', 'info');
                });
                result.innerHTML = '<span class="text-danger">‚ùå Button not found</span>';
            }
        }

        function step3() {
            log('Step 3: Manually attaching click event...', 'info');
            const result = document.getElementById('step3-result');

            const logoutBtn = document.getElementById('logoutBtn');

            if (!logoutBtn) {
                log('‚ùå Button not found. Run Step 1 and 2 first.', 'error');
                result.innerHTML = '<span class="text-danger">‚ùå Button not found</span>';
                return;
            }

            try {
                logoutBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    log('üéâ CLICK EVENT FIRED!', 'success');
                    alert('Logout button clicked! Event is working.');
                });

                log('‚úÖ Event listener attached successfully', 'success');
                result.innerHTML = '<span class="text-success">‚úÖ Event attached. Now try clicking the logout button in the sidebar.</span>';
            } catch (error) {
                log('‚ùå Error attaching event: ' + error.message, 'error');
                result.innerHTML = '<span class="text-danger">‚ùå ' + error.message + '</span>';
            }
        }

        function step4() {
            log('Step 4: Simulating click...', 'info');
            const result = document.getElementById('step4-result');

            const logoutBtn = document.getElementById('logoutBtn');

            if (!logoutBtn) {
                log('‚ùå Button not found', 'error');
                result.innerHTML = '<span class="text-danger">‚ùå Button not found</span>';
                return;
            }

            log('Triggering click event...', 'info');
            logoutBtn.click();
            log('Click triggered. Check if alert appeared.', 'info');
            result.innerHTML = '<span class="text-info">Click triggered. Did you see an alert?</span>';
        }

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', () => {
            log('=== Logout Button Debugger Started ===', 'info');
            log('Click the buttons in order: Step 1 ‚Üí Step 2 ‚Üí Step 3 ‚Üí Step 4', 'info');
        });
    </script>
</body>

</html>